{"version":3,"file":"DeprecationIssue_test.js","sourceRoot":"","sources":["../../../../../../../../../../../third_party/devtools-frontend/src/test/unittests/front_end/panels/issues/DeprecationIssue_test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nconst {assert} = chai;\n\nimport * as Issues from '../../../../../front_end/panels/issues/issues.js';\nimport * as IssuesManager from '../../../../../front_end/models/issues_manager/issues_manager.js';\nimport type * as SDK from '../../../../../front_end/core/sdk/sdk.js';\nimport {MockIssuesModel} from '../../models/issues_manager/MockIssuesModel.js';\nimport * as Protocol from '../../../../../front_end/generated/protocol.js';\nimport {describeWithLocale} from '../../helpers/EnvironmentHelpers.js';\nimport {MockIssuesManager} from '../../models/issues_manager/MockIssuesManager.js';\n\ndescribeWithLocale('DeprecationIssue', async () => {\n  const mockModel = new MockIssuesModel([]) as unknown as SDK.IssuesModel.IssuesModel;\n  const mockManager = new MockIssuesManager([]) as unknown as IssuesManager.IssuesManager.IssuesManager;\n\n  function createDeprecationIssue(type: Protocol.Audits.DeprecationIssueType):\n      IssuesManager.DeprecationIssue.DeprecationIssue {\n    return new IssuesManager.DeprecationIssue.DeprecationIssue(\n        {\n          sourceCodeLocation: {\n            url: 'empty.html',\n            lineNumber: 1,\n            columnNumber: 1,\n          },\n          type,\n        },\n        mockModel);\n  }\n\n  function createDeprecationIssueDetails(type: Protocol.Audits.DeprecationIssueType): Protocol.Audits.InspectorIssue {\n    return {\n      code: Protocol.Audits.InspectorIssueCode.DeprecationIssue,\n      details: {\n        deprecationIssueDetails: {\n          sourceCodeLocation: {\n            url: 'empty.html',\n            lineNumber: 1,\n            columnNumber: 1,\n          },\n          type,\n        },\n      },\n    };\n  }\n\n  it('normal deprecation issue works', () => {\n    const details = createDeprecationIssueDetails(Protocol.Audits.DeprecationIssueType.DeprecationExample);\n    const issue = IssuesManager.DeprecationIssue.DeprecationIssue.fromInspectorIssue(mockModel, details);\n    assert.isNotEmpty(issue);\n  });\n\n  it('aggregates issues with the same type', () => {\n    const issues = [\n      createDeprecationIssue(Protocol.Audits.DeprecationIssueType.DeprecationExample),\n      createDeprecationIssue(Protocol.Audits.DeprecationIssueType.DeprecationExample),\n    ];\n    const aggregator = new Issues.IssueAggregator.IssueAggregator(mockManager);\n    for (const issue of issues) {\n      mockManager.dispatchEventToListeners(\n          IssuesManager.IssuesManager.Events.IssueAdded, {issuesModel: mockModel, issue});\n    }\n    const aggregatedIssues = Array.from(aggregator.aggregatedIssues());\n    assert.strictEqual(aggregatedIssues.length, 1);\n    const deprecationIssues = Array.from(aggregatedIssues[0].getDeprecationIssues());\n    assert.strictEqual(deprecationIssues.length, 2);\n  });\n\n  it('does not aggregate issues with different types', () => {\n    const issues = [\n      createDeprecationIssue(Protocol.Audits.DeprecationIssueType.DeprecationExample),\n      createDeprecationIssue(Protocol.Audits.DeprecationIssueType.CrossOriginWindowAlert),\n    ];\n    const aggregator = new Issues.IssueAggregator.IssueAggregator(mockManager);\n    for (const issue of issues) {\n      mockManager.dispatchEventToListeners(\n          IssuesManager.IssuesManager.Events.IssueAdded, {issuesModel: mockModel, issue});\n    }\n    const aggregatedIssues = Array.from(aggregator.aggregatedIssues());\n    assert.strictEqual(aggregatedIssues.length, 2);\n  });\n});\n"]}