{"version":3,"file":"FrameDetailsView_test.js","sourceRoot":"","sources":["../../../../../../../../../../../../third_party/devtools-frontend/src/test/unittests/front_end/panels/application/components/FrameDetailsView_test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {assertNotNullOrUndefined} from '../../../../../../front_end/core/platform/platform.js';\nimport * as SDK from '../../../../../../front_end/core/sdk/sdk.js';\nimport * as Protocol from '../../../../../../front_end/generated/protocol.js';\nimport * as ApplicationComponents from '../../../../../../front_end/panels/application/components/components.js';\nimport * as ExpandableList from '../../../../../../front_end/ui/components/expandable_list/expandable_list.js';\nimport * as Coordinator from '../../../../../../front_end/ui/components/render_coordinator/render_coordinator.js';\nimport * as ReportView from '../../../../../../front_end/ui/components/report_view/report_view.js';\nimport {\n  assertShadowRoot,\n  getCleanTextContentFromElements,\n  getElementsWithinComponent,\n  getElementWithinComponent,\n  renderElementIntoDOM,\n} from '../../../helpers/DOMHelpers.js';\nimport {describeWithRealConnection} from '../../../helpers/RealConnection.js';\n\nconst coordinator = Coordinator.RenderCoordinator.RenderCoordinator.instance();\n\nconst {assert} = chai;\n\nconst makeFrame = (): SDK.ResourceTreeModel.ResourceTreeFrame => {\n  const newFrame: SDK.ResourceTreeModel.ResourceTreeFrame = {\n    url: 'https://www.example.com/path/page.html',\n    securityOrigin: 'https://www.example.com',\n    displayName: () => 'TestTitle',\n    unreachableUrl: () => '',\n    adFrameType: () => Protocol.Page.AdFrameType.None,\n    adFrameStatus: () => undefined,\n    getAdScriptId: () => '1' as Protocol.Runtime.ScriptId,\n    resourceForURL: () => null,\n    isSecureContext: () => true,\n    isCrossOriginIsolated: () => true,\n    getCrossOriginIsolatedContextType: () => Protocol.Page.CrossOriginIsolatedContextType.NotIsolatedFeatureDisabled,\n    getSecureContextType: () => Protocol.Page.SecureContextType.SecureLocalhost,\n    getGatedAPIFeatures: () =>\n        [Protocol.Page.GatedAPIFeatures.SharedArrayBuffers,\n         Protocol.Page.GatedAPIFeatures.SharedArrayBuffersTransferAllowed],\n    getOwnerDOMNodeOrDocument: () => ({\n      nodeName: () => 'iframe',\n    }),\n    resourceTreeModel: () => ({\n      target: () => ({\n        // set to true so that Linkifier.maybeLinkifyScriptLocation() exits\n        // early and does not run into other problems with this mock\n        isDisposed: () => true,\n        model: () => ({\n          getSecurityIsolationStatus: () => ({\n            coep: {\n              value: Protocol.Network.CrossOriginEmbedderPolicyValue.None,\n              reportOnlyValue: Protocol.Network.CrossOriginEmbedderPolicyValue.None,\n            },\n            coop: {\n              value: Protocol.Network.CrossOriginOpenerPolicyValue.SameOrigin,\n              reportOnlyValue: Protocol.Network.CrossOriginOpenerPolicyValue.SameOrigin,\n            },\n          }),\n        }),\n      }),\n    }),\n    getCreationStackTraceData: () => ({\n      creationStackTrace: {\n        callFrames: [{\n          functionName: 'function1',\n          url: 'http://www.example.com/script.js',\n          lineNumber: 15,\n          columnNumber: 10,\n          scriptId: 'someScriptId',\n        }],\n      },\n      creationStackTraceTarget: null,\n    }),\n    getOriginTrials: async () => ([\n      {\n        trialName: 'AppCache',\n        status: 'Enabled',\n        tokensWithStatus: [{\n          status: 'Success',\n          rawTokenText: 'Text',\n          parsedToken: {\n            trialName: 'AppCache',\n            origin: 'https://foo.com',\n            expiryTime: 1000,\n            usageRestriction: 'None',\n            isThirdParty: false,\n            matchSubDomains: false,\n          },\n        }],\n      },\n    ]),\n    getPermissionsPolicyState: () => null,\n    prerenderFinalStatus: Protocol.Page.PrerenderFinalStatus.TriggerDestroyed,\n  } as unknown as SDK.ResourceTreeModel.ResourceTreeFrame;\n  return newFrame;\n};\n\ndescribeWithRealConnection('FrameDetailsView', () => {\n  it('renders with a title', async () => {\n    const frame = makeFrame();\n    const component = new ApplicationComponents.FrameDetailsView.FrameDetailsReportView();\n    renderElementIntoDOM(component);\n    component.data = {\n      frame: frame,\n    };\n\n    assertShadowRoot(component.shadowRoot);\n    await coordinator.done();\n    const report = getElementWithinComponent(component, 'devtools-report', ReportView.ReportView.Report);\n    assertShadowRoot(report.shadowRoot);\n\n    const titleElement = report.shadowRoot.querySelector('.report-title');\n    assert.strictEqual(titleElement?.textContent, frame.displayName());\n  });\n\n  it('renders report keys and values', async () => {\n    const targetManager = SDK.TargetManager.TargetManager.instance();\n    const target = targetManager.mainTarget();\n    assertNotNullOrUndefined(target);\n    const debuggerModel = target.model(SDK.DebuggerModel.DebuggerModel);\n    assertNotNullOrUndefined(debuggerModel);\n    const debuggerId = debuggerModel.debuggerId();\n\n    const frame = makeFrame();\n    frame.adFrameType = () => Protocol.Page.AdFrameType.Root,\n    frame.getDebuggerId = () => debuggerId as Protocol.Runtime.UniqueDebuggerId;\n\n    const component = new ApplicationComponents.FrameDetailsView.FrameDetailsReportView();\n    renderElementIntoDOM(component);\n    component.data = {frame, target};\n\n    assertShadowRoot(component.shadowRoot);\n    await coordinator.done();\n    await coordinator.done();  // 2nd call awaits async render\n\n    const keys = getCleanTextContentFromElements(component.shadowRoot, 'devtools-report-key');\n    assert.deepEqual(keys, [\n      'URL',\n      'Origin',\n      'Owner Element',\n      'Frame Creation Stack Trace',\n      'Ad Status',\n      'Creator Ad Script',\n      'Secure Context',\n      'Cross-Origin Isolated',\n      'Cross-Origin Embedder Policy (COEP)',\n      'Cross-Origin Opener Policy (COOP)',\n      'SharedArrayBuffers',\n      'Measure Memory',\n      'Prerendering Status',\n    ]);\n\n    const values = getCleanTextContentFromElements(component.shadowRoot, 'devtools-report-value');\n    assert.deepEqual(values, [\n      'https://www.example.com/path/page.html',\n      'https://www.example.com',\n      '<iframe>',\n      '',\n      '',\n      '\\u200b',\n      'Yes\\xA0Localhost is always a secure context',\n      'Yes',\n      'None',\n      'SameOrigin',\n      'available, transferable',\n      'available\\xA0Learn more',\n      'Prerender is not activated and destroyed with the trigger.',\n    ]);\n\n    const stackTrace = getElementWithinComponent(\n        component, 'devtools-resources-stack-trace', ApplicationComponents.StackTrace.StackTrace);\n    assertShadowRoot(stackTrace.shadowRoot);\n    const expandableList =\n        getElementWithinComponent(stackTrace, 'devtools-expandable-list', ExpandableList.ExpandableList.ExpandableList);\n    assertShadowRoot(expandableList.shadowRoot);\n\n    const stackTraceRows = getElementsWithinComponent(\n        expandableList, 'devtools-stack-trace-row', ApplicationComponents.StackTrace.StackTraceRow);\n    let stackTraceText: string[] = [];\n\n    stackTraceRows.forEach(row => {\n      assertShadowRoot(row.shadowRoot);\n      stackTraceText = stackTraceText.concat(getCleanTextContentFromElements(row.shadowRoot, '.stack-trace-row'));\n    });\n\n    assert.deepEqual(stackTraceText[0], 'function1\\xA0@\\xA0http://www.example.com/script.js:16');\n\n    const adScriptLink = component.shadowRoot.querySelector('devtools-report-value.ad-script-link');\n    assertNotNullOrUndefined(adScriptLink);\n    assert.strictEqual(adScriptLink.textContent, '\\u200b');\n  });\n});\n"]}