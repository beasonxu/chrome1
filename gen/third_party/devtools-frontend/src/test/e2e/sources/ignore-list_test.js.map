{"version":3,"file":"ignore-list_test.js","sourceRoot":"","sources":["../../../../../../../../../third_party/devtools-frontend/src/test/e2e/sources/ignore-list_test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2022 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {assert} from 'chai';\n\nimport {\n  click,\n  enableExperiment,\n  getBrowserAndPages,\n  getPendingEvents,\n  goToResource,\n  installEventListener,\n  step,\n  waitFor,\n  waitForFunction,\n  waitForNone,\n} from '../../shared/helper.js';\nimport {describe, it} from '../../shared/mocha-extensions.js';\nimport {setIgnoreListPattern} from '../helpers/settings-helpers.js';\nimport {\n  addBreakpointForLine,\n  DEBUGGER_PAUSED_EVENT,\n  getCallFrameNames,\n  openSourceCodeEditorForFile,\n  openSourcesPanel,\n  PAUSE_INDICATOR_SELECTOR,\n  readSourcesTreeView,\n  RESUME_BUTTON,\n  stepIn,\n  stepOut,\n} from '../helpers/sources-helpers.js';\n\ndescribe('Ignore list', async function() {\n  it('can be toggled on and off in call stack', async function() {\n    await setIgnoreListPattern('thirdparty');\n    const {target, frontend} = getBrowserAndPages();\n\n    await openSourceCodeEditorForFile('multi-files-mycode.js', 'multi-files.html');\n    await addBreakpointForLine(frontend, 4);\n\n    const scriptEvaluation = target.evaluate('f();');\n    await waitFor(RESUME_BUTTON);\n    await waitFor('.ignore-listed-call-frame.hidden');\n    assert.deepEqual(await getCallFrameNames(), ['inner', 'outer', '(anonymous)']);\n\n    // Toggle to show ignore-listed frames\n    await click('.ignore-listed-message-label');\n    await waitFor('.ignore-listed-call-frame:not(.hidden)');\n    assert.deepEqual(await getCallFrameNames(), ['inner', 'innercall', 'callfunc', 'outer', '(anonymous)']);\n\n    // Toggle back off\n    await click('.ignore-listed-message-label');\n    await waitFor('.ignore-listed-call-frame.hidden');\n    assert.deepEqual(await getCallFrameNames(), ['inner', 'outer', '(anonymous)']);\n\n    await click(RESUME_BUTTON);\n    await scriptEvaluation;\n  });\n\n  // Flaky.\n  it.skip('[crbug.com/1346232] shows no toggle when everything is ignore-listed', async function() {\n    await setIgnoreListPattern('multi|puppeteer');\n    const {target, frontend} = getBrowserAndPages();\n\n    await openSourceCodeEditorForFile('multi-files-mycode.js', 'multi-files.html');\n    await addBreakpointForLine(frontend, 4);\n\n    const scriptEvaluation = target.evaluate('f();');\n    await waitFor(RESUME_BUTTON);\n\n    // Toggle is not shown\n    await waitFor('.ignore-listed-message.hidden');\n    // There are visible ignore-listed frames\n    await waitFor('.ignore-listed-call-frame:not(.hidden)');\n    // All frames are shown\n    assert.deepEqual(await getCallFrameNames(), ['inner', 'innercall', 'callfunc', 'outer', '(anonymous)']);\n\n    await click(RESUME_BUTTON);\n    await scriptEvaluation;\n  });\n\n  it('skips frames when stepping in and out', async function() {\n    await setIgnoreListPattern('thirdparty');\n    const {target, frontend} = getBrowserAndPages();\n    installEventListener(frontend, DEBUGGER_PAUSED_EVENT);\n\n    await openSourceCodeEditorForFile('multi-files-mycode.js', 'multi-files.html');\n    await addBreakpointForLine(frontend, 8);\n\n    const scriptEvaluation = target.evaluate('f();');\n    await waitFor(RESUME_BUTTON);\n    await waitFor(PAUSE_INDICATOR_SELECTOR);\n    await waitForFunction(async () => await getPendingEvents(frontend, DEBUGGER_PAUSED_EVENT));\n    assert.deepEqual(await getCallFrameNames(), ['outer', '(anonymous)']);\n\n    await step('Step in', stepIn);\n    await waitFor('.call-frame-title-text[title=\"inner\"]');\n    await waitFor('.ignore-listed-call-frame.hidden');\n    assert.deepEqual(await getCallFrameNames(), ['inner', 'outer', '(anonymous)']);\n\n    await step('Step out', stepOut);\n    await waitForNone('.call-frame-title-text[title=\"inner\"]');\n    assert.deepEqual(await getCallFrameNames(), ['outer', '(anonymous)']);\n\n    await click(RESUME_BUTTON);\n    await scriptEvaluation;\n  });\n\n  it('removes ignored sources from page source tree', async function() {\n    await enableExperiment('justMyCode');\n    await setIgnoreListPattern('thirdparty');\n    await goToResource('sources/multi-files.html');\n    await openSourcesPanel();\n    assert.deepEqual(\n        await readSourcesTreeView(),\n        ['top', 'localhost:XXXX', 'test/e2e/resources/sources', 'multi-files.html', 'multi-files-mycode.js']);\n  });\n});\n"]}