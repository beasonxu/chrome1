import*as e from"../../../core/host/host.js";import*as t from"../../../core/platform/platform.js";import*as s from"../../legacy/legacy.js";import*as i from"../../lit-html/lit-html.js";import*as o from"../helpers/helpers.js";import*as r from"../render_coordinator/render_coordinator.js";import*as n from"../icon_button/icon_button.js";import*as l from"../../../core/i18n/i18n.js";const a=new CSSStyleSheet;a.replaceSync(':host{height:100%;display:block;position:relative}.wrapping-container{overflow-y:auto;height:100%}.wrapping-container::-webkit-scrollbar{display:none}table{border-spacing:0;width:100%;height:100%;table-layout:fixed}tr{outline:0}thead tr{height:27px}tbody tr{background-color:var(--override-data-grid-row-background-color,--color-background)}tbody tr.selected{background-color:var(--color-background-elevation-1)}td,th{padding:1px 4px;border-left:1px solid var(--color-details-hairline);color:var(--color-text-primary);line-height:var(--table-row-height);height:var(--table-row-height);user-select:text;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}th{font-weight:400;text-align:left;border-bottom:1px solid var(--color-details-hairline);position:sticky;top:0;z-index:2;background-color:var(--color-background-elevation-1)}td:focus,th:focus{outline:var(--color-primary) auto 1px}.cell-resize-handle{top:0;height:100%;z-index:3;width:20px;cursor:col-resize;position:absolute}td.firstVisibleColumn,th.firstVisibleColumn{border-left:none}.hidden{display:none}.filler-row td{height:100%;pointer-events:none;padding:0}.filler-row.empty-table td{padding:1px}[aria-sort=descending]::after{content:"";width:0;border-left:.4em solid transparent;border-right:.4em solid transparent;border-top:.4em solid var(--color-text-secondary);position:absolute;right:.5em;top:.85em}[aria-sort=ascending]::after{content:"";width:0;border-bottom:.4em solid var(--color-text-secondary);border-left:.4em solid transparent;border-right:.4em solid transparent;position:absolute;right:.5em;top:.7em}\n/*# sourceURL=dataGrid.css */\n');class d extends Event{static eventName="columnheaderclick";data;constructor(e,t){super(d.eventName),this.data={column:e,columnIndex:t}}}class c extends Event{static eventName="contextmenucolumnsortclick";data;constructor(e){super(c.eventName),this.data={column:e}}}class h extends Event{static eventName="contextmenuheaderresetclick";constructor(){super(h.eventName)}}class u extends Event{static eventName="newuserfiltertext";data;constructor(e){super(u.eventName,{composed:!0}),this.data={filterText:e}}}class m extends Event{static eventName="cellfocused";data;constructor(e,t){super(m.eventName,{composed:!0}),this.data={cell:e,row:t}}}var p=Object.freeze({__proto__:null,ColumnHeaderClickEvent:d,ContextMenuColumnSortClickEvent:c,ContextMenuHeaderResetClickEvent:h,NewUserFilterTextEvent:u,BodyCellFocusedEvent:m});function f(e,t){const s=!t.visible,i=e.data.columns.map((e=>(e===t&&(e.visible=s),e)));e.data={...e.data,columns:i}}function w(e,t){const{columns:s}=e.data;for(const i of s)i.hideable&&t.defaultSection().appendCheckboxItem(i.title,(()=>{f(e,i)}),i.visible)}function g(e,t){const s=e.data.columns.filter((e=>!0===e.sortable));if(s.length>0)for(const i of s)t.defaultSection().appendItem(i.title,(()=>{e.dispatchEvent(new c(i))}))}const b=e=>i.html`${e}`;var C=Object.freeze({__proto__:null,primitiveRenderer:b,codeBlockRenderer:e=>{if(!e)return i.nothing;const t=String(e);return i.html`<code>${t}</code>`}});function v(e){return JSON.stringify(e.map((e=>e.value instanceof n.Icon.Icon?null:e.value))).toLowerCase()}function x(e,t){const s=e.cells.find((e=>e.columnId===t));if(void 0===s)throw new Error(`Found a row that was missing an entry for column ${t}.`);return s}function R(e){return e.renderer?e.renderer(e.value):b(e.value)}function S(e,t){const s=e.filter((e=>e.visible)).reduce(((e,t)=>e+t.widthWeighting),0),i=e.find((e=>e.id===t));if(!i)throw new Error(`Could not find column with ID ${t}`);if(i.widthWeighting<1)throw new Error(`Error with column ${t}: width weightings must be >= 1.`);return i.visible?Math.round(i.widthWeighting/s*100):0}function y(e){const{key:s,currentFocusedCell:i,columns:o,rows:r}=e,[n,l]=i;switch(s){case"ArrowLeft":{if(n===o.findIndex((e=>e.visible)))return[n,l];let e=n;for(let t=e-1;t>=0;t--){if(o[t].visible){e=t;break}}return[e,l]}case"ArrowRight":{let e=n;for(let t=e+1;t<o.length;t++){if(o[t].visible){e=t;break}}return[e,l]}case"ArrowUp":{const e=o.some((e=>!0===e.sortable))?0:1;if(l===e)return[n,l];let t=l;for(let s=l-1;s>=e;s--){if(0===s){t=0;break}if(!r[s-1].hidden){t=s;break}}return[n,t]}case"ArrowDown":{if(0===l){const e=r.findIndex((e=>!e.hidden));return e>-1?[n,e+1]:[n,l]}let e=l;for(let t=e+1;t<r.length+1;t++){if(!r[t-1].hidden){e=t;break}}return[n,e]}default:return t.assertNever(s,`Unknown arrow key: ${s}`)}}const M=e=>{const{columns:t,rows:s}=e,i=t.some((e=>!0===e.sortable))?0:s.findIndex((e=>!e.hidden))+1;return[t.findIndex((e=>e.visible)),i]},I=e=>e.length<25?e:e.substr(0,20)+"â€¦";var $=Object.freeze({__proto__:null,getStringifiedCellValues:v,getRowEntryForColumnId:x,renderCellValue:R,calculateColumnWidthPercentageFromWeighting:S,handleArrowKeyNavigation:y,calculateFirstFocusableCell:M,getCellTitleFromCellContent:I});const F=r.RenderCoordinator.RenderCoordinator.instance(),O={sortBy:"Sort By",resetColumns:"Reset Columns",headerOptions:"Header Options"},D=l.i18n.registerUIStrings("ui/components/data_grid/DataGrid.ts",O),T=l.i18n.getLocalizedString.bind(void 0,D),H=new Set([" ","Enter"]);class k extends HTMLElement{static litTagName=i.literal`devtools-data-grid`;#e=this.attachShadow({mode:"open"});#t=[];#s=[];#i=null;#o=!1;#r="NOT_SCROLLED";#n=void 0;#l=void 0;#a=10;#d=null;#c=new WeakMap;#h=new ResizeObserver((()=>{this.#u()}));#m=this.#p.bind(this);#f=[0,1];#w=null;#g=!1;#b=!1;#C=!1;connectedCallback(){this.#e.adoptedStyleSheets=[a],o.SetCSSProperty.set(this,"--table-row-height","18px")}get data(){return{columns:this.#t,rows:this.#s,activeSort:this.#i,contextMenus:this.#n,label:this.#l,paddingRowsCount:this.#a}}set data(e){if(this.#t=e.columns,this.#s=e.rows,this.#s.forEach(((e,t)=>{this.#c.set(e,t)})),this.#i=e.activeSort,this.#n=e.contextMenus,this.#l=e.label,this.#g||(this.#f=M({columns:this.#t,rows:this.#s})),void 0!==e.paddingRowsCount&&(this.#a=e.paddingRowsCount),this.#g&&this.#v()){const[e,t]=this.#x(),s=e>this.#t.length,i=t>this.#s.length;(s||i)&&(this.#w=[s?this.#t.length:e,i?this.#s.length:t])}this.#R()}#S(){return"SCROLLED_TO_BOTTOM"===this.#r||!this.#b&&"MANUAL_SCROLL_NOT_BOTTOM"!==this.#r}#y(){if(!1===this.#g||!this.#S())return;const e=this.#e.querySelector(".wrapping-container");e&&F.scroll((()=>{const t=e.scrollHeight;e.scrollTo(0,t)}))}#M(){this.#g||this.#h.observe(this.#e.host)}#v(){return null!==this.#w}#I(){if(!this.#w)return null;const[e,t]=this.#w;return this.#e.querySelector(`[data-row-index="${t}"][data-col-index="${e}"]`)}async#$(e){await F.write((()=>{e.focus()}))}#F([e,t]){if(this.#b=!0,this.#w&&this.#w[0]===e&&this.#w[1]===t)return;this.#w=[e,t],this.#R();const s=this.#I();s&&this.#$(s)}#O(e){const s=e.key;if(!this.#w)return;if(H.has(s)){const[e,t]=this.#w,s=this.#t[e];0===t&&s&&s.sortable&&this.#D(s,e)}if(!t.KeyboardUtilities.keyIsArrowKey(s))return;const i=y({key:s,currentFocusedCell:this.#w,columns:this.#t,rows:this.#s});e.preventDefault(),this.#F(i)}#D(e,t){this.dispatchEvent(new d(e,t))}#T(e){return!e.sortable||this.#i&&this.#i.columnId===e.id?this.#i&&this.#i.columnId===e.id?"ASC"===this.#i.direction?"ascending":"descending":void 0:"none"}#H(e){const t=this.#t.map(((e,t)=>{if(!e.visible)return i.nothing;const s=i.Directives.classMap({firstVisibleColumn:0===t});return i.html`<td aria-hidden="true" class="${s}" data-filler-row-column-index="${t}">`})),s=i.Directives.classMap({"filler-row":!0,"padding-row":!0,"empty-table":0===e});return i.html`<tr aria-hidden="true" class="${s}">${t}`}#k(){this.#d&&(this.#d.documentForCursorChange.body.style.cursor=this.#d.cursorToRestore,this.#d=null,this.#u())}#z(t){if(1!==t.buttons||e.Platform.isMac()&&t.ctrlKey)return;t.preventDefault();const s=t.target;if(!s)return;const i=s.dataset.columnIndex;if(!i)return;const o=globalThis.parseInt(i,10),r=this.#t.findIndex(((e,t)=>t>o&&!0===e.visible)),n=this.#e.querySelector(`td[data-filler-row-column-index="${o}"]`),l=this.#e.querySelector(`td[data-filler-row-column-index="${r}"]`);if(!n||!l)return;const a=this.#e.querySelector(`col[data-col-column-index="${o}"]`),d=this.#e.querySelector(`col[data-col-column-index="${r}"]`);if(!a||!d)return;const c=t.target.ownerDocument;c&&(this.#d={leftCellCol:a,rightCellCol:d,leftCellColInitialPercentageWidth:globalThis.parseInt(a.style.width,10),rightCellColInitialPercentageWidth:globalThis.parseInt(d.style.width,10),initialLeftCellWidth:n.clientWidth,initialRightCellWidth:l.clientWidth,initialMouseX:t.x,documentForCursorChange:c,cursorToRestore:s.style.cursor},c.body.style.cursor="col-resize",s.setPointerCapture(t.pointerId),s.addEventListener("pointermove",this.#m))}#p(e){if(e.preventDefault(),!this.#d)return;const s=this.#d.leftCellColInitialPercentageWidth+this.#d.rightCellColInitialPercentageWidth-10,i=e.x-this.#d.initialMouseX,o=Math.abs(i)/(this.#d.initialLeftCellWidth+this.#d.initialRightCellWidth)*100;let r,n;i>0?(r=t.NumberUtilities.clamp(this.#d.leftCellColInitialPercentageWidth+o,10,s),n=t.NumberUtilities.clamp(this.#d.rightCellColInitialPercentageWidth-o,10,s)):i<0&&(r=t.NumberUtilities.clamp(this.#d.leftCellColInitialPercentageWidth-o,10,s),n=t.NumberUtilities.clamp(this.#d.rightCellColInitialPercentageWidth+o,10,s)),r&&n&&(this.#d.leftCellCol.style.width=r.toFixed(2)+"%",this.#d.rightCellCol.style.width=n.toFixed(2)+"%")}#E(e){e.preventDefault();const t=e.target;t&&(t.releasePointerCapture(e.pointerId),t.removeEventListener("pointermove",this.#m),this.#k())}#U(e,t){const[s]=t;return s!==this.#_()&&e.visible?i.html`<span class="cell-resize-handle" @pointerdown="${this.#z}" @pointerup="${this.#E}" data-column-index="${s}"></span>`:i.nothing}#_(){let e=this.#t.length-1;for(;e>-1;e--){if(this.#t[e].visible)break}return e}#L(e){if(2!==e.button)return;const t=new s.ContextMenu.ContextMenu(e);w(this,t);g(this,t.defaultSection().appendSubMenuItem(T(O.sortBy))),t.defaultSection().appendItem(T(O.resetColumns),(()=>{this.dispatchEvent(new h)})),this.#n&&this.#n.headerRow&&this.#n.headerRow(t,this.#t),t.show()}#A(e){if(2!==e.button)return;if(!(e.target&&e.target instanceof HTMLElement))return;const t=e.target.dataset.rowIndex;if(!t)return;const i=parseInt(t,10),o=this.#s[i-1],r=new s.ContextMenu.ContextMenu(e);g(this,r.defaultSection().appendSubMenuItem(T(O.sortBy)));const n=r.defaultSection().appendSubMenuItem(T(O.headerOptions));w(this,n),n.defaultSection().appendItem(T(O.resetColumns),(()=>{this.dispatchEvent(new h)})),this.#n&&this.#n.bodyRow&&this.#n.bodyRow(r,this.#t,o),r.show()}#N(e){const t=e.target;if(!t)return;const s=Math.round(t.scrollTop+t.clientHeight)===Math.round(t.scrollHeight);this.#r=s?"SCROLLED_TO_BOTTOM":"MANUAL_SCROLL_NOT_BOTTOM",this.#R()}#u(){return F.read((()=>{const e=this.#e.querySelectorAll("th:not(.hidden)"),t=this.#e.querySelectorAll(".cell-resize-handle");this.#e.querySelector("table")&&e.forEach((async(e,s)=>{const i=e.clientWidth,o=e.offsetLeft;if(t[s]){const e=t[s].clientWidth;F.write((()=>{t[s].style.left=o+i-e+"px"}))}}))}))}#W(){return F.read((()=>{const e=this.#e.querySelector(".wrapping-container");let t=0,s=window.innerHeight;e&&(t=e.scrollTop,s=e.clientHeight);const i=18*this.#a;let o=Math.floor((t-i)/18),r=Math.ceil((t+s+i)/18);return o=Math.max(0,o),r=Math.min(this.#s.filter((e=>!e.hidden)).length,r),{topVisibleRow:o,bottomVisibleRow:r}}))}#P(){this.#b=!1}#x(){return this.#w||this.#f}async#R(){if(this.#o)return void(this.#C=!0);this.#o=!0;const{topVisibleRow:e,bottomVisibleRow:t}=await this.#W(),s=this.#s.filter((e=>!e.hidden)),o=s.filter(((s,i)=>i>=e&&i<=t)),r=this.#t.findIndex((e=>e.visible)),n=this.#t.some((e=>!0===e.sortable));await F.write((()=>{i.render(i.html` ${this.#t.map(((e,t)=>this.#U(e,[t,0])))} <div class="wrapping-container" @scroll="${this.#N}" @focusout="${this.#P}"> <table aria-label="${i.Directives.ifDefined(this.#l)}" aria-rowcount="${this.#s.length}" aria-colcount="${this.#t.length}" @keydown="${this.#O}"> <colgroup> ${this.#t.map(((e,t)=>{const s=`width: ${S(this.#t,e.id)}%`;return e.visible?i.html`<col style="${s}" data-col-column-index="${t}">`:i.nothing}))} </colgroup> <thead> <tr @contextmenu="${this.#L}"> ${this.#t.map(((e,t)=>{const s=i.Directives.classMap({hidden:!e.visible,firstVisibleColumn:t===r}),o=this.#x(),l=n&&t===o[0]&&0===o[1];return i.html`<th class="${s}" style="${i.Directives.ifDefined(e.styles?i.Directives.styleMap(e.styles):void 0)}" data-grid-header-cell="${e.id}" @focus="${()=>{this.#F([t,0])}}" @click="${()=>{this.#D(e,t)}}" title="${e.title}" aria-sort="${i.Directives.ifDefined(this.#T(e))}" aria-colindex="${t+1}" data-row-index="0" data-col-index="${t}" tabindex="${i.Directives.ifDefined(n?l?"0":"-1":void 0)}">${e.titleElement||e.title}`}))} </tr> </thead> <tbody> <tr class="filler-row-top padding-row" style="${i.Directives.styleMap({height:18*e+"px"})}" aria-hidden="true"></tr> ${i.Directives.repeat(o,(e=>this.#c.get(e)),(e=>{const t=this.#c.get(e);if(void 0===t)throw new Error("Trying to render a row that has no index in the rowIndexMap");const s=this.#x(),o=t+1,n=!!this.#w&&o===this.#w[1],l=i.Directives.classMap({selected:n,hidden:!0===e.hidden});return i.html` <tr aria-rowindex="${t+1}" class="${l}" style="${i.Directives.ifDefined(e.styles?i.Directives.styleMap(e.styles):void 0)}" @contextmenu="${this.#A}">${this.#t.map(((t,n)=>{const l=x(e,t.id),a=i.Directives.classMap({hidden:!t.visible,firstVisibleColumn:n===r}),d=n===s[0]&&o===s[1],c=t.visible?R(l):null;return i.html`<td class="${a}" style="${i.Directives.ifDefined(t.styles?i.Directives.styleMap(t.styles):void 0)}" tabindex="${d?"0":"-1"}" aria-colindex="${n+1}" title="${l.title||I(String(l.value))}" data-row-index="${o}" data-col-index="${n}" data-grid-value-cell-for-column="${t.id}" @focus="${()=>{this.#F([n,o]),this.dispatchEvent(new m(l,e))}}">${c}`}))} `}))} ${this.#H(o.length)} <tr class="filler-row-bottom padding-row" style="${i.Directives.styleMap({height:18*Math.max(0,s.length-t)+"px"})}" aria-hidden="true"></tr> </tbody> </table> </div> `,this.#e,{host:this})}));const l=this.#x()[1],a=this.#I();this.#b&&l>0&&a&&this.#$(a),this.#y(),this.#M(),this.#g&&this.#u(),this.#o=!1,this.#g=!0,this.#C&&(this.#C=!1,this.#R())}}o.CustomElements.defineComponent("devtools-data-grid",k);var z=Object.freeze({__proto__:null,DataGrid:k});const E=new CSSStyleSheet;E.replaceSync(":host{display:block;height:100%;overflow:hidden}\n/*# sourceURL=dataGridController.css */\n");class U extends HTMLElement{static litTagName=i.literal`devtools-data-grid-controller`;#e=this.attachShadow({mode:"open"});#g=!1;#t=[];#s=[];#n=void 0;#l=void 0;#G=[];#B=[];#i=null;#q=[];#a;connectedCallback(){this.#e.adoptedStyleSheets=[E]}get data(){return{columns:this.#G,rows:this.#B,filters:this.#q,contextMenus:this.#n,label:this.#l,paddingRowsCount:this.#a}}set data(e){this.#G=e.columns,this.#B=e.rows,this.#n=e.contextMenus,this.#q=e.filters||[],this.#n=e.contextMenus,this.#l=e.label,this.#t=[...this.#G],this.#s=this.#j(e.rows,this.#q),!this.#g&&e.initialSort&&(this.#i=e.initialSort),this.#i&&this.#V(this.#i),this.#a=e.paddingRowsCount,this.#R()}#K(e,t){let s=!1;const{key:i,text:o,negative:r,regex:n}=t;let l;return l=v(i?[x(e,i)]:e.cells),n?s=n.test(l):o&&(s=l.includes(o.toLowerCase())),r?!s:s}#j(e,t){return 0===t.length?[...e]:e.map((e=>{let s=!0;for(const i of t){if(!this.#K(e,i)){s=!1;break}}return{...e,hidden:!s}}))}#V(e){const{columnId:t,direction:s}=e;this.#s.sort(((e,i)=>{const o=x(e,t),r=x(i,t),n="number"==typeof o.value?o.value:String(o.value).toUpperCase(),l="number"==typeof r.value?r.value:String(r.value).toUpperCase();return n<l?"ASC"===s?-1:1:n>l?"ASC"===s?1:-1:0})),this.#R()}#D(e){const{column:t}=e.data;t.sortable&&this.#X(t)}#X(e){if(this.#i&&this.#i.columnId===e.id){const{columnId:e,direction:t}=this.#i;this.#i="DESC"===t?null:{columnId:e,direction:"DESC"}}else this.#i={columnId:e.id,direction:"ASC"};this.#i?this.#V(this.#i):(this.#s=this.#j(this.#B,this.#q),this.#R())}#J(e){this.#X(e.data.column)}#Q(){this.#i=null,this.#s=[...this.#B],this.#R()}#R(){i.render(i.html` <${k.litTagName} .data="${{columns:this.#t,rows:this.#s,activeSort:this.#i,contextMenus:this.#n,label:this.#l,paddingRowsCount:this.#a}}" @columnheaderclick="${this.#D}" @contextmenucolumnsortclick="${this.#J}" @contextmenuheaderresetclick="${this.#Q}"></${k.litTagName}> `,this.#e,{host:this}),this.#g=!0}}o.CustomElements.defineComponent("devtools-data-grid-controller",U);var _=Object.freeze({__proto__:null,DataGridController:U});class L extends s.Widget.VBox{dataGrid;constructor(e){super(!0,!0),this.dataGrid=new U,this.dataGrid.data=e,this.contentElement.appendChild(this.dataGrid)}data(){return this.dataGrid.data}update(e){this.dataGrid.data=e}}var A=Object.freeze({__proto__:null,DataGridControllerIntegrator:L});export{z as DataGrid,_ as DataGridController,A as DataGridControllerIntegrator,p as DataGridEvents,C as DataGridRenderers,$ as DataGridUtils};
