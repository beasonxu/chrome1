{"version":3,"file":"snippets_test.js","sourceRoot":"","sources":["../../../../../../../../../third_party/devtools-frontend/src/test/e2e/snippets/snippets_test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {assert} from 'chai';\n\nimport {getBrowserAndPages, typeText, waitFor, waitForFunction} from '../../shared/helper.js';\nimport {describe, it} from '../../shared/mocha-extensions.js';\nimport {maybeGetCurrentConsoleMessages} from '../helpers/console-helpers.js';\nimport {getAvailableSnippets, openCommandMenu, showSnippetsAutocompletion} from '../helpers/quick_open-helpers.js';\nimport {\n  addSelectedTextToWatches,\n  createNewSnippet,\n  evaluateSelectedTextInConsole,\n  getWatchExpressionsValues,\n  openSnippetsSubPane,\n  openSourcesPanel,\n  runSnippet,\n} from '../helpers/sources-helpers.js';\n\ndescribe('Snippet creation', () => {\n  it('can show newly created snippets show up in command menu', async () => {\n    const {frontend} = getBrowserAndPages();\n\n    await openSourcesPanel();\n    await openSnippetsSubPane();\n    await createNewSnippet('New snippet');\n\n    await openCommandMenu();\n    await showSnippetsAutocompletion();\n\n    assert.deepEqual(await getAvailableSnippets(), [\n      'New snippet\\u200B',\n    ]);\n\n    await typeText('New ');\n    assert.deepEqual(await getAvailableSnippets(), [\n      'New snippet\\u200B',\n    ]);\n\n    await typeText('w');\n    assert.deepEqual(await getAvailableSnippets(), []);\n\n    await frontend.keyboard.press('Backspace');\n    assert.deepEqual(await getAvailableSnippets(), [\n      'New snippet\\u200B',\n    ]);\n  });\n});\n\ndescribe('Expression evaluation', () => {\n  const message = '\\'Hello\\'';\n  async function selectFunctionParameterElement() {\n    const {frontend} = getBrowserAndPages();\n    const functionParameterElement = await waitFor('.token-variable');\n    const parameterElementPosition = await functionParameterElement.evaluate(elem => {\n      const {x, y, right} = elem.getBoundingClientRect();\n      return {x, y, right};\n    });\n    await frontend.mouse.move(parameterElementPosition.x, parameterElementPosition.y);\n    await frontend.mouse.down();\n    await frontend.mouse.move(parameterElementPosition.right, parameterElementPosition.y);\n    await frontend.mouse.up();\n  }\n\n  async function navigateToSourcesAndRunSnippet() {\n    await openSourcesPanel();\n    await openSnippetsSubPane();\n    await createNewSnippet('New snippet');\n    await typeText(`(x => {debugger})(${message});`);\n    await runSnippet();\n  }\n\n  afterEach(async () => {\n    const {frontend} = getBrowserAndPages();\n    await frontend.reload();\n  });\n\n  it('evaluates a selected expression in the console', async () => {\n    await navigateToSourcesAndRunSnippet();\n    const messages = await waitForFunction(async () => {\n      await selectFunctionParameterElement();\n      await evaluateSelectedTextInConsole();\n      const maybeMessages = await maybeGetCurrentConsoleMessages();\n      if (maybeMessages.length) {\n        return maybeMessages;\n      }\n      await openSourcesPanel();\n      await openSnippetsSubPane();\n      return null;\n    });\n    assert.deepEqual(messages, [\n      message,\n    ]);\n  });\n\n  it('adds an expression to watches', async () => {\n    await navigateToSourcesAndRunSnippet();\n    const watchExpressions = await waitForFunction(async () => {\n      await selectFunctionParameterElement();\n      await addSelectedTextToWatches();\n      return await getWatchExpressionsValues();\n    });\n\n    if (!watchExpressions) {\n      assert.fail('No watch expressions found');\n    }\n    const cleanWatchExpressions = watchExpressions.map(expression => expression.replace(/[\"]+/g, '\\''));\n    assert.deepEqual(cleanWatchExpressions[0], message);\n  });\n});\n\ndescribe('Snippet evaluation', () => {\n  it('highlights the correct line when a snippet throws an error', async () => {\n    await openSourcesPanel();\n    await openSnippetsSubPane();\n    await createNewSnippet('throwing', `\n      (function foo() {\n        throw new Error('kaboom');\n      })();`);\n\n    await runSnippet();\n\n    const errorLine = await waitFor('.cm-waveUnderline');\n    const text = await errorLine.evaluate(el => el.textContent);\n    assert.strictEqual(text, 'throw new Error(\\'kaboom\\');');\n  });\n});\n"]}